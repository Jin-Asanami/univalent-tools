#!/usr/bin/env bash

set -u

selected=""

function package_manage () {
	while true; do

	clear
    echo " ┌──────────────────────┐ "
    echo " │ [Package Management] │"
    echo " ├──────────────────────┴───────────────────────────┐"
    echo " │  1 - Update All Packages   2 - Search Package    │"
    echo " │  3 - Install Package       4 - Remove Package    │"
    echo " │  5 - Show Package Details  6 - Clean Caches      │"
    echo " │                                                  │"
    echo " │                            0 - Cancel            │"
    echo " └──────────────────────────────────────────────────┘"

    echo -n " [select] > "
	read -n1 selected
	echo ""
	if [[ ${selected} == "0" ]]; then
		return
	fi

	if [[ ${selected} != "1" ]] && [[ ${selected} != "6" ]]; then
		local package_name
    	echo -n " [Package name?] > "
		read package_name
		if [[ ${package_name} == "0" ]]; then
			return
		fi
	fi


	echo ""
	case ${selected} in
		0) return                           ;;
		1) sudo pacman -Syu                 ;;
		2)      pacman -Ss ${package_name}  ;;
		3) sudo pacman -S ${package_name}   ;;
		4) sudo pacman -Rns ${package_name} ;;
		5)      pacman -Qi ${package_name}  ;;
		6) sudo pacman -Scc                 ;;
	esac
	echo "Completed!!"
	echo "Press any key to continue..."
	read -n1 selected

	done
}

function time_settings () {
	while true; do

	clear
    echo " ┌─────────────────┐"
    echo " │ [Time Settings] │"
    echo " ├─────────────────┴──────────────────────────────────┐"
    echo " │ 1 - Change Time Zone        2 - Sync Time with NTP │"
    echo " │ 3 - Write to Hardware Clock 4 - Change auto sync   │"
    echo " │                                                    │"
    echo " │                             0 - Cancel             │"
    echo " └────────────────────────────────────────────────────┘"

    echo -n " [select] > "
	read -n1 selected

	if [[ ${selected} == "4" ]]; then
    	echo -n "y = enable, or n = disable [y/n]: "
		while true; do
		local ntp
			read -n1 ntp
			[[ ${ntp} == "y" ||  ${ntp} == "n" ]] && exit 0
		done
	fi


	echo ""
	case ${selected} in
		0) return                          ;;
		1) tzselect                        ;;
		2) sudo ntpdate -B pool.ntp.org    ;;
		3) sudo hwclock --systohc --local  ;;
		4) sudo timedatectl set-ntp ${ntp} ;;
	esac
	echo ""

	done
}

function main () {
	clear
    echo " ┌────────────────────────────┐"
    echo " │ [Welcome to system menu!!] │"
    echo " ├────────────────────────────┴─────────────────────┐"
    echo " │ 1 - Display         2 - Network                  │"
    echo " │ 3 - Sound           4 - Package Management       │"
    echo " │ 5 - Time settings                                │"
    echo " │                                                  │"
    echo " │                     0 - Exit                     │"
    echo " └──────────────────────────────────────────────────┘"

    echo -n " [select] > "
	read -n1 selected

	echo ""
	case ${selected} in
		0) exit 0          ;;
		1) arandr          ;;
		2) nmtui           ;;
		3) pavucontrol     ;;
		4) package_manage  ;;
		5) time_settings   ;;
	esac
	echo ""
}

while true; do
	main
done
